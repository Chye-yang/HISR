# HISR项目环境配置指南

## 📋 环境要求

### 系统要求
- **操作系统**: Linux/Windows/macOS
- **Python**: >= 3.8 (推荐3.9+)
- **GPU**: 可选（CUDA >= 11.0，用于加速训练）

### 必需依赖包
已生成 `requirements.txt` 文件，包含所有必需依赖。

## 🚀 快速安装

### 方法1: 使用pip安装
```bash
# 创建虚拟环境（推荐）
python -m venv hisr_env
source hisr_env/bin/activate  # Linux/macOS
# 或 hisr_env\Scripts\activate  # Windows

# 安装依赖
pip install -r requirements.txt
```

### 方法2: 使用conda安装
```bash
# 创建conda环境
conda create -n hisr python=3.9
conda activate hisr

# 安装PyTorch（根据CUDA版本选择）
conda install pytorch torchvision torchaudio pytorch-cuda=11.8 -c pytorch -c nvidia

# 安装其他依赖
pip install -r requirements.txt
```

## 🔧 详细安装步骤

### 1. 验证Python环境
```bash
python --version  # 确保Python >= 3.8
pip --version     # 验证pip可用
```

### 2. 安装核心依赖
```bash
# 安装Torch（根据你的硬件选择）
# CPU版本
pip install torch>=2.0.0 torchvision torchaudio

# 或GPU版本（CUDA 11.8）
pip install torch>=2.0.0 torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

# 安装其他核心依赖
pip install numpy>=1.21.0 tqdm>=4.60.0
```

### 3. 安装其他依赖
```bash
# 模型相关
pip install timm>=0.6.0 transformers>=4.20.0

# 数据处理
pip install ftfy>=6.0.0 regex>=2022.0.0 tokenizers>=0.13.0

# 实验工具
pip install huggingface-hub>=0.10.0
```

## 🧪 环境验证

### 1. 运行环境检查脚本
```bash
python demo_hisr_minimal.py
```

### 2. 验证依赖包
```python
# 在Python中运行以下代码验证关键包
import torch
import numpy as np
import tqdm
import timm
from transformers import AutoTokenizer

print("✅ 所有核心依赖包已正确安装")
print(f"PyTorch版本: {torch.__version__}")
print(f"Numpy版本: {np.__version__}")

# 验证GPU支持（如可用）
if torch.cuda.is_available():
    print(f"✅ GPU可用: {torch.cuda.get_device_name(0)}")
else:
    print("⚠️ GPU不可用，将使用CPU模式")
```

## 🔍 故障排除

### 常见问题1: Torch安装失败
```bash
# 解决方案: 使用官方索引
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
```

### 常见问题2: 权限问题
```bash
# 解决方案: 使用用户安装或虚拟环境
pip install --user -r requirements.txt
```

### 常见问题3: 版本冲突
```bash
# 解决方案: 清理后重新安装
pip freeze | xargs pip uninstall -y
pip install -r requirements.txt
```

## 📊 Hardware推荐配置

### 最低配置
- CPU: 4核心以上
- 内存: 8GB
- 磁盘: 10GB可用空间

### 推荐配置
- CPU: 8核心以上  
- 内存: 16GB+
- GPU: NVIDIA RTX 3060+ (8GB显存)
- 磁盘: 20GB+可用空间

## 🔄 环境备份与恢复

### 导出环境配置
```bash
pip freeze > requirements_full.txt
```

### 从备份恢复
```bash
pip install -r requirements_full.txt
```

## 📈 性能优化建议

### GPU加速
- 确保安装对应CUDA版本的PyTorch
- 使用 `torch.cuda.is_available()` 验证GPU可用性

### 内存优化
- 适当调整 `bucket_len` 参数控制内存使用
- 分批处理大数据集

---

**下一步**: 环境配置完成后，可以运行 `python run_hisr_experiment.py` 开始实验！